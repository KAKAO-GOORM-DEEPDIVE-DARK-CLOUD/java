## 인터페이스는 구현하는 쪽을 생각해 설계하라

> [!NOTE]
>
> 디폴트 메서드란,
> 인터페이스에서 메서드의 기본 구현을 제공하는 메서드이며,
> 해당 인터페이스를 구현한 클래스가 직접 구현하지 않아도 자동으로 상속받는 메서드를 말한다.
>
> 그렇기 때문에, 추상 메서드는 실행부가 없지만 디폴트 메서드는 실행부가 존재한다.
>
> ```java
> public interface RemoteControl {
> 	//상수 필드
> 	int MAX_VOLUME = 10;
> 	int MIN_VOLUME = 0;
> 
> 	//추상 메소드
> 	void turnOn();
> 	void turnOff();
> 	void setVolume(int volume);
> 
> 	//디폴트 메소드
> 	default void setMute(boolean mute) {
> 		if(mute) {
> 			System.out.println("무음 처리합니다.");
> 			setVolume(MIN_VOLUME); //추상 메서드를 호출하면서 상수 필드 사용
> 		} else {
> 			System.out.println("무음 해제합니다.");
>           		setVolume(5);
> 		}
> 	}
> }
> ```
>
> 



### 1. 디폴트 메서드는 위험한 양날의 검이다

- 자바 8 이전엔 인터페이스에 메서드 추가 시, 구현체가 모두 깨졌지만  
- 자바 8부터는 디폴트 메서드로 기존 구현체를 깨지 않고 메서드 추가 가능  
- 하지만 기존 구현체가 디폴트 메서드를 의도하지 않게 상속받게 되는 문제가 생김

### 2. removeIf 예시: 동기화 깨짐

- `Collection 인터페이스`에 추가된 디폴트 메서드인 `removeIf()`는 일반 컬렉션엔 잘 작동하지만  
- **동기화 컬렉션(SynchronizedCollection)**에는 심각한 버그 발생 가능  
- 이유: 디폴트 구현이 락(lock)을 고려하지 않음 → `ConcurrentModificationException` 발생

### 3. 기존 인터페이스에 디폴트 메서드 추가는 정말 신중하게

- 디폴트 메서드를 추가하면 기존 구현체에 미치는 영향은 **예측 불가**  
- 디폴트 메서드는 컴파일에 성공하더라도 **기존 구현체에 런타임 오류를 일으킬 수 있다.**  
- 디폴트 메서드는 인터페이스로부터 메서드를 제거하거나 기존 메서드의 시그니처 변경을 피하기 위한 임시방편이 아니라, 명확한 목적과 설계를 바탕으로 추가되어야 한다.

> [!TIP]
>
> #### "시그니처를 바꿔야 하는 상황에서, 디폴트 메서드를 추가하는 방식으로 ‘피해 가는’ 예시
>
> **기존 인터페이스**
>
> ```java
> public interface Calculator {
>     int add(int a, int b);
> }
> ```
>
> 이 인터페이스를 수많은 클래스들이 이미 구현하고 있음
>
> 
>
> **요구사항이 추가되면서 로그를 남기면서 더하는 기능이 필요하게 됨**
>
> ```java
> public interface Calculator {
>     int add(int a, int b);
>     int add(int a, int b, boolean log); // ❌ 기존 클래스들 전부 컴파일 에러
> }
> ```
>
> 이건 시그니처 변경으로 기존 구현체 전부 깨짐
>
> 
>
> **그래서 이렇게 우회한다 → 디폴트 메서드**
>
> ```java
> public interface Calculator {
>     int add(int a, int b);
> 
>     default int addWithLog(int a, int b) {
>         System.out.println("Adding " + a + " and " + b);
>         return add(a, b);
>     }
> }
> 
> ```
>
> 



### 4. 디폴트 메서드는 신중하게, 테스트는 철저히

- 릴리스 전에 반드시:
  - 서로 다른 방식으로 **최소 세 가지 구현체**를 만들어 테스트
  - 다양한 상황에서 API가 안전하게 동작하는지 확인
- 한 번 릴리스한 인터페이스는 **절대 수정 불가**하다고 생각하고 설계
  - 인터페이스를 공개하는 순간, 그걸 구현하는 수많은 클래스들이 생김 -> 이를 수정하면 이전에 구현한 모든 구현체가 깨짐

---

## 결론

- 디폴트 메서드는 **좋은 도구**지만, **남용 시 재앙**이 될 수 있음  
- 기존 인터페이스 수정보다는 **새 인터페이스 설계**를 고민하는 것이 바람직  
- 릴리스 전 **최소 3개 이상 구현체를 직접 만들어 테스트**하라
